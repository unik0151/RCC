架构：
应用层
合约层
激励层
共识层
网络层
数据层

# 什么是以太坊
    * 以太坊是一个区块链平台，支持中心化应用Dapp的开发和应用

# 以太坊的概念是由谁首次提出的，并在何时
    * 以太坊的概念由 Vitalik Buterin 在 2013 年底提出，并在《比特币杂志》中发表的一篇白皮书中详细阐述

# 以太坊的首个公开发布是在什么时候，哪里进行的
    * 以太坊在 2014 年 1 月的迈阿密北美比特币会议上首次对外公开发布

# "The DAO"是什么，以及它如何影响以太坊
    * The DAO 是一个基于以太坊的分布式自治组织，旨在作为一个去中心化的投资基金
    * 2016 年，由于一个安全漏洞，DAO 项目被黑客攻击，导致以太坊进行了一次重大的硬分叉

# 以太坊进行硬分叉的目的是什么
    * 硬分叉的目的是为了恢复因 The DAO 安全漏洞而被盗的资金，并尝试解决安全问题
    * 这次分叉最终导致以太坊分成了两条链：ETH 和 ETC

# 什么是企业以太坊联盟（EEA），它成立于何时
    * 企业以太坊联盟（EEA）是一个由多家区块链初创公司、研究小组和财富 500 强公司组成的联盟，成立于 2017 年 3 月，旨在推动以太坊技术的商业应用

# 以太坊 2.0 与以太坊 1.0 有何不同
    * 以太坊 2.0 被视为“共识层”，采用 PoS（权益证明）作为共识机制，而以太坊 1.0 被称为“执行层”，主要负责交易的处理和执行
    * 以太坊 2.0 还包括了一系列其他升级，如增加交易吞吐量和引入分片技术

# Metamask 插件的主要功能是什么
    * Metamask 是一个浏览器插件，允许用户通过图形界面进行交易、编写和部署合约，同时管理其以太坊钱包和账户

# 在以太坊中，'gas'的概念是用来做什么的
    * 在以太坊中，'gas'用来衡量执行交易或智能合约时所需的计算工作量，同时也是矿工执行这些操作所需费用的计量单位

# 什么是智能合约
    * 智能合约是一段存储在以太坊区块链上的代码，可以自动执行合同条款
    * 通过运行在EVM以太坊虚拟机中执行合约，与区块链网络进行隔离，有一套自己的运行环境，保证了代码漏洞不影响区块链网络系统的稳定以及安全
    * 一旦部署，智能合约的行为将不可变更，确保了合同执行的透明性和不可篡改性

# 如何在以太坊上创建一个账户
    * 通过安装metamask 等以太坊钱包软件，并设置密码来管理钱包
    * 账户创建时，用户获得一组助记词，便捷用户记忆

# 以太坊的挖矿机制是如何工作的
    * 在以太坊1.0中，挖矿是通过工作量证明（POW）共识机制完成的
，矿工是通过消耗计算资源解决数学难题获取区块的记账权
    * 在以太坊2.0中，系统转向（POS）权益证明执行的，保证了交易的高效性和安全性

# 描述以太坊交易的基本组成部分
    * 交易包含：消息的接收者，确认发送者身份的私钥签名，转移的以太币数量，附带信息，gas,gaslimit等参数

# 什么是以太坊虚拟机（EVM）
    * 以太坊虚拟机（EVM）是执行合约的运行平台，可以独立外部系统运行代码，保证智能合约的透明性和安全执行

# 以太坊的区块结构包括哪些部分
    * 区块头（Block Header）‌和‌区块体（Block Body）‌两部分组成

    * 区块头：
        - 父哈希（Parent Has）：‌父哈希（Parent Hash）‌：记录此区块直接引用的父区块哈希值，确保区块链的连续性
        - 叔区块哈希（Uncles Has）：记录引用的叔区块哈希值，用于处理孤儿区块
        - 矿工地址（Miner）‌：记录挖出该区块的矿工地址，挖矿奖励将下发到此账户
        - 状态根哈希（State Root）‌：表示执行完该区块中的所有交易后以太坊状态的快照ID
        - ‌交易根哈希（Transactions Root）‌：表示该区块中所有交易的默克尔树根哈希值
        - 凭证树根哈希（Receipts Root）‌：表示该区块中所有交易执行后的凭证树的根哈希值‌

    ‌区块体：
        区块体包含具体的交易数据，每个交易都有一个唯一的交易哈希值，这些哈希值组成了交易树的根哈希值。交易树确保了区块内所有交易的完整性，防止交易被篡改‌

    默克尔树（Merkle Tree）：
        二叉树结构，用于校验数据完整性，每个叶子节点都是一个交易的has值，
        非叶子节点是子节点哈希值的合并，当少部分数据改变时，根哈希值也会改变，最终校验会不通过，这种方式确保了交易的完整性和安全性

    收集叔区块：矿工在打包新区块时，会从网络中收集‌最多两个‌符合条件的叔区块（需满足：叔区块必须是当前区块的‌前两代祖先的子区块‌，即距离当前区块高度不超过 7 代）。
‌示例‌：若当前区块高度为 N，可引用的叔区块高度范围为 N-1 至 N-7
    *（POW）1.0时期 区块头包含 Nonce 和 Difficulty，依赖算力竞争，
    2.0 （‌PoS‌）：移除 Nonce 和 Difficulty，新增 Slot、Epoch、验证者签名等字段，依赖质押权益验证
    
# 以太坊数据层的主要功能是什么
    * 对打包进区块，并且共识机制验证后，添加到主链区块，区块的交易凭证
    通过key-value键值对方式记录到底层数据库LevelDB数据库，并使用 Merkle Patricia Tree（MPT）数据结构进行管理。这一层是区块链架构的基础组成部分

# 以太坊中有哪两种类型的账户
    * 分为外部账户和合约账户两种
    * 外部账户由用户创建，可以通过私钥签名发送交易保证数据安全
    * 合约账户由合约代码控制，只能在接收到交易时被动执行，必须外部账户发起交易才会调用到合约

# 以太坊如何防止外部账户的重复支付问题
    * Nonce 机制：‌
        - Nonce 定义‌：每个外部账户（EOA）的每笔交易都包含一个 ‌nonce‌ 值，它是一个从 0 开始递增的整数，用于标识交易的顺序‌
        - Nonce 规则‌：
    如果交易的 nonce 值‌小于当前账户的 nonce 值‌，交易会被直接拒绝‌6。
    如果交易的 nonce 值‌大于当前账户的 nonce 值‌，交易会被暂存到交易池中，直到缺失的 nonce 值被补齐‌6。
    只有交易的 nonce 值‌等于当前账户的 nonce 值‌时，交易才会被执行，同时账户的 nonce 值递增‌
        ‌作用‌：确保每笔交易只能被执行一次，防止重复支付‌
    * 交易队列限制：
        -队列容量‌：以太坊的交易池对每个账户的交易队列设置了‌最大容量限制‌，通常为 64 笔交易‌
        - 作用‌：防止恶意用户通过发送大量交易阻塞网络，同时确保交易处理的顺序性和唯一性‌
    * 余额检查：
        - 在执行交易时，以太坊会检查账户的‌余额是否足够支付交易费用和转账金额‌。如果余额不足，交易会被拒绝‌
        - ‌作用‌：防止因余额不足导致的无效交易或重复支付尝试‌
    * 交易哈希唯一性：
        - ‌交易哈希‌：每笔交易都有一个唯一的‌交易哈希‌，由交易内容（包括 nonce、发送者地址、接收者地址、金额等）计算得出‌
        - 作用‌：确保每笔交易在区块链中只能被记录一次，防止重复提交‌
    * 网络共识机制：
        - 共识验证‌：以太坊的共识机制（如 PoW 或 PoS）确保所有节点对交易的执行顺序和结果达成一致‌
        - 作用‌：防止恶意节点通过篡改交易顺序或内容导致重复支付‌

# 描述以太坊的合约账户如何被创建
    * 以太坊的合约账户是通过消耗一定的gas手续费创建的
    * 不由私钥管理，而是合约的部署者管理控制
    - 合约账户可以编写特定函数来实现所有权的转移或继承

# 以太坊中交易的两大类别是什么
    * 以太坊的交易分为：消息通信和合约创建
    * 这两种类型的交易都是由外部账户发起并提交到以太坊网络，然后通过网络传输，并最终记录在以太坊区块链上

# 以太坊是如何实现交易签名和验证的
    答案：
        - 以太坊当前使用的是基于 EIP-155 的签名方案，引入了交易重放保护机制
        - 这包括在交易数据结构中添加链标识符，确保在一个链上创建的交易不能在其他链上重放

简单来说：使用ECDSA（椭圆曲线数字签名算法），通过数学运算，生成与消息和私钥绑定的数字签名，本质是一个可验证的数学证明
通过对待签名消息进行keccak256哈希运算，得到固定长度的消息哈希值
该算法生成一个临时私钥（随机数），


    * 交易签名的实现
        - 签名过程：
            - 签名工具‌：使用以太坊提供的工具（如 web3.js 或 ethers.js）对交易进行签名‌
            - 签名内容‌：对交易数据（包括 nonce、接收者地址、金额、gas 价格等）进行哈希运算，生成待签名的消息‌
            - 签名算法‌：使用 ‌ECDSA（椭圆曲线数字签名算法）‌，基于用户的私钥对消息进行签名‌
            - 签名结果‌：生成一个包含 r、s 和 v 值的签名数据，用于后续验证
        - 签名细节：
            - 消息前缀‌：以太坊在签名时会为消息添加前缀 \x19Ethereum Signed Message:\n，以防止签名被误用于其他场景‌
            - 哈希计算‌：对消息进行 ‌Keccak-256‌ 哈希运算，生成最终的签名数据‌
    * 交易验证的实现：
        - 验证过程：
            - 验证工具‌：通过智能合约或以太坊节点对签名进行验证‌
            - 验证内容‌：检查签名的 r、s 和 v 值是否有效，并恢复出签名者的公钥‌
            - 使用 ‌ecrecover‌ 函数从签名中恢复出签名者的地址，并与预期的发送者地址进行比对‌
        - 验证细节：
            - ecrecover 函数‌：以太坊提供的内置函数，用于从签名中恢复出签名者的地址‌
            - 如果恢复出的地址与交易发送者地址一致，则验证通过，否则拒绝交易‌
    * 签名与验证的应用场景：
        - 交易签名‌：用户在发送交易时，使用私钥对交易数据进行签名，确保交易的真实性和不可篡改性‌
        - 智能合约验证‌：智能合约可以通过验证签名来确认调用者的身份，实现权限控制‌
        - 多签名钱包‌：多个用户对同一笔交易进行签名，确保资金的安全性和管理的去中心化‌
    * 总结
        - 以太坊通过 ‌ECDSA 签名算法‌ 和 ‌ecrecover 验证机制‌，实现了交易签名和验证的全流程。签名过程确保交易的真实性和不可篡改性，而验证过程则通过恢复签名者地址来确认交易的合法性‌12。这种机制为以太坊网络提供了强大的安全保障。

# 以太坊区块的封印（Seal）过程包括哪些关键步骤
    * 以太坊区块的封印过程首先包括创建一个完整的新区块，这包括填充区块头的部分属性、编排交易列表、添加 uncle 区块等
    * 封印阶段涉及计算难度值、随机数和混合哈希值，这一过程确保了区块的安全性

# 以太坊如何处理网络中同时产生的多个区块
    * 以太坊在处理同时产生的多个区块时，会选择总难度最高的链作为主链
    * 这通过比较不同链的区块难度值来决定哪个链包含更多的累计工作量，从而被选为主链。

# 描述以太坊 P2P 网络中的 Kademlia（Kad）协议的基本工作原理
    * Kademlia 协议是基于分布式哈希表的 P2P 网络协议，使用异或距离来测量节点间距离，并通过维护一个路由表来实现节点查找和资源定位
    * 节点通过向距离目标节点最近的其他节点发送查询请求来查找目标节点或数据

# 以太坊节点如何实现数据的存储和检索
    * 以太坊节点通过 Kademlia 协议实现数据的存储和检索
    # 数据存储时，将数据的副本存储在距离数据键最近的 k 个节点上
    # 数据查找时，节点基于数据键进行搜索，目标是找到实际存储该数据的节点或更接近目标数据的节点